<fieldset class="row g-3">
    <legend class="visually-hidden">Create CMP</legend>
    <!-- CMP Type -->
    <div class="position-relative {{ cmpCreationConfig.fieldCustomClass?.['CMP_TYPE'] }}">
        <span class="d-flex coi-text-dark pb-1">
            <span *ngIf="cmpCreationConfig.isEditMode && cmpCreationConfig.mandatoryFieldsList?.[createLocalObject?.cmpType?.cmpTypeCode]?.includes('CMP_TYPE')"
                class="mandatory me-1">*</span>
            <span>CMP Type</span>
            <app-common-help-text [subSectionId]="2902" [elementId]="'coi-new-cmp-type'"></app-common-help-text>
        </span>
        <!-- options -->
        <div class="d-flex gap-4">
            <app-dynamic-select class="col d-flex align-items-center gap-3"
                [lookupList]="cmpTypeLookup" [isDisabled]="cmpCreationConfig.disabledFields?.['CMP_TYPE']"
                [uniqueId]="'coi-new-cmp-type'" [label]="'CMP Type'"
                [selectedValue]="{
                    code: createLocalObject?.cmpType?.cmpTypeCode,
                    description: createLocalObject?.cmpType?.description }"
                [isError]="cmpCreationConfig.errorMsgMap.has('CMP_TYPE')"
                (selectedValueChange)="cmpTypeChanged($event)">
            </app-dynamic-select>
        </div>
        <app-common-information [elementId]="'coi-new-cmp-type'" [subSectionId]="2902"></app-common-information>
        <!-- error -->
        <span *ngIf="cmpCreationConfig.errorMsgMap.has('CMP_TYPE')"
            class="d-block invalid-feedback fs-13">{{ cmpCreationConfig.errorMsgMap.get('CMP_TYPE') }}</span>
    </div>

    <!-- Person -->
    <div *ngIf="createLocalObject?.cmpType?.cmpTypeCode === CMP_TYPE.UNIVERSITY"
        class="position-relative {{ cmpCreationConfig.fieldCustomClass?.['PERSON_SEARCH'] }}">
        <label class="d-flex coi-text-dark pb-1" for="coi-new-cmp-person">
            <span *ngIf="cmpCreationConfig.isEditMode && cmpCreationConfig.mandatoryFieldsList?.[createLocalObject?.cmpType?.cmpTypeCode]?.includes('PERSON_SEARCH')"
                class="mandatory me-1">*</span>
            <span>Person</span>
            <app-common-help-text [subSectionId]="2902" [elementId]="'coi-new-cmp-person'"></app-common-help-text>
        </label>
        <app-elastic [options]="personSearchOptions"
            [uniqueId]="'coi-new-cmp-person'"
            [placeHolder]="'Search by Person'"
            [isDisabled]="cmpCreationConfig.disabledFields?.['PERSON_SEARCH']"
            [canEmitSearchText]="false" (selectedResult)="selectedPerson($event)"
            [isError]="cmpCreationConfig.errorMsgMap.has('PERSON_SEARCH')">
        </app-elastic>
        <app-common-information [elementId]="'coi-new-cmp-person'" [subSectionId]="2902"></app-common-information>
        <app-common-person-card *ngIf="personSearchResult?.personId"
            [personDetails]="personSearchResult" [customClass]="'coi-card-highlight'"></app-common-person-card>
        <!-- error -->
        <span *ngIf="cmpCreationConfig.errorMsgMap.has('PERSON_SEARCH')"
            class="d-block invalid-feedback fs-13">{{ cmpCreationConfig.errorMsgMap.get('PERSON_SEARCH') }}</span>
    </div>

    <!-- Sub-Award Investigator -->
    <div *ngIf="createLocalObject?.cmpType?.cmpTypeCode === CMP_TYPE.NON_UNIVERSITY"
        class="position-relative {{ cmpCreationConfig.fieldCustomClass?.['SUB_AWARD_INVESTIGATOR'] }}">
        <label class="d-flex coi-text-dark pb-1" for="coi-new-cmp-investigator">
            <span *ngIf="cmpCreationConfig.isEditMode && cmpCreationConfig.mandatoryFieldsList?.[createLocalObject?.cmpType?.cmpTypeCode]?.includes('SUB_AWARD_INVESTIGATOR')"
                class="mandatory me-1">*</span>
            <span>Sub-Award Investigator</span>
            <app-common-help-text [subSectionId]="2902" [elementId]="'coi-new-cmp-investigator'"></app-common-help-text>
            <div class="d-flex gap-4 ms-auto">
                <app-dynamic-select class="col d-flex align-items-center gap-3"
                    [lookupList]="employeeLookup"
                    [isDisabled]="cmpCreationConfig.disabledFields?.['SUB_AWARD_INVESTIGATOR']"
                    [uniqueId]="'coi-new-cmp-employee-type'" [label]="'Employee Type'"
                    [selectedValue]="{ code: (createLocalObject?.employeeType), description: '' }"
                    (selectedValueChange)="employeeTypeChanged($event)">
                </app-dynamic-select>
            </div>
        </label>
        <app-elastic [options]="subAwardInvestigatorOptions"
            [uniqueId]="'coi-new-cmp-investigator'"
            [placeHolder]="'Search by Sub-Award Investigator'"
            [isDisabled]="cmpCreationConfig.disabledFields?.['SUB_AWARD_INVESTIGATOR']"
            [canEmitSearchText]="false" (selectedResult)="selectedSubAwardPerson($event)"
            [isError]="cmpCreationConfig.errorMsgMap.has('SUB_AWARD_INVESTIGATOR')">
        </app-elastic>
        <app-common-information [elementId]="'coi-new-cmp-investigator'" [subSectionId]="2902"></app-common-information>
        <app-common-person-card *ngIf="personSearchResult?.personId || personSearchResult?.rolodexId"
            [personDetails]="personSearchResult" [customClass]="'coi-card-highlight'"></app-common-person-card>
        <!-- error -->
        <span *ngIf="cmpCreationConfig.errorMsgMap.has('SUB_AWARD_INVESTIGATOR')"
            class="d-block invalid-feedback fs-13">{{ cmpCreationConfig.errorMsgMap.get('SUB_AWARD_INVESTIGATOR') }}</span>
    </div>

    <!-- Sub-Award Investigator -->
    <div *ngIf="createLocalObject?.cmpType?.cmpTypeCode === CMP_TYPE.NON_UNIVERSITY"
        class="position-relative {{ cmpCreationConfig.fieldCustomClass?.['SUB_AWARD_INSTITUTE'] }}">
        <label class="d-flex coi-text-dark pb-1" for="coi-new-cmp-organization">
            <span *ngIf="cmpCreationConfig.isEditMode && cmpCreationConfig.mandatoryFieldsList?.[createLocalObject?.cmpType?.cmpTypeCode]?.includes('SUB_AWARD_INSTITUTE')"
                class="mandatory me-1">*</span>
            <span>Sub-Award Institute</span>
            <app-common-help-text [subSectionId]="2902" [elementId]="'coi-new-cmp-organization'"></app-common-help-text>
        </label>
        <app-endpoint-search [httpOptions]="subAwardInstituteOptions"
            (onSelect)="selectedInstitute($event)" [uniqueId]="'coi-new-cmp-organization'"
            [isDisabled]="cmpCreationConfig.disabledFields?.['SUB_AWARD_INSTITUTE']"
            [isError]="cmpCreationConfig.errorMsgMap.has('SUB_AWARD_INSTITUTE')"
            [placeHolder]="'Search by Sub-Award Institute'">
        </app-endpoint-search>
        <app-common-information [elementId]="'coi-new-cmp-organization'" [subSectionId]="2902"></app-common-information>
        <!-- error -->
        <span *ngIf="cmpCreationConfig.errorMsgMap.has('SUB_AWARD_INSTITUTE')"
            class="d-block invalid-feedback fs-13">{{ cmpCreationConfig.errorMsgMap.get('SUB_AWARD_INSTITUTE') }}</span>
    </div>

    <!-- Entity -->
    <div class="position-relative {{ cmpCreationConfig.fieldCustomClass?.['ENTITY_SEARCH'] }}">
        <label class="d-flex coi-text-dark pb-1" for="coi-new-cmp-entity">
            <span *ngIf="cmpCreationConfig.isEditMode && cmpCreationConfig.mandatoryFieldsList?.[createLocalObject?.cmpType?.cmpTypeCode]?.includes('ENTITY_SEARCH')"
                class="mandatory me-1">*</span>
            <span>Entity</span>
            <app-common-help-text [subSectionId]="2902" [elementId]="'coi-new-cmp-entity'"></app-common-help-text>
        </label>
        <app-elastic (selectedResult)="selectedEntity($event)" [canEmitSearchText]="false"
            [isError]="cmpCreationConfig.errorMsgMap.has('ENTITY_SEARCH')"
            [addNewValue]="'ALLOW_ALL'" (newValueSelect)="addNewEntity($event)"
            [isDisabled]="cmpCreationConfig.disabledFields?.['ENTITY_SEARCH']"
            [options]="entitySearchOptions" [placeHolder]="'Search by Entity'" [uniqueId]="'coi-new-cmp-entity'">
        </app-elastic>
        <app-common-information [elementId]="'coi-new-cmp-entity'" [subSectionId]="2902"></app-common-information>
        <app-shared-entity-info-card *ngIf="selectedEntityDetails?.entityName" [triggeredFrom]="'CMP'"
            [entityDetails]="selectedEntityDetails" [customClass]="'coi-card-highlight'" [isEditMode]="!selectedEntityDetails?.entityId">
        </app-shared-entity-info-card>
        <!-- error -->
        <span *ngIf="cmpCreationConfig.errorMsgMap.has('ENTITY_SEARCH')"
            class="d-block invalid-feedback fs-13">{{ cmpCreationConfig.errorMsgMap.get('ENTITY_SEARCH') }}</span>
    </div>

    <!-- Project -->
    <div *ngIf="projectsTypesLookup?.length" class="position-relative {{ cmpCreationConfig.fieldCustomClass?.['PROJECT'] }}">
        <fieldset class="d-flex flex-column gap-3" [ngClass]="{ 'border rounded-3 p-3': projectsTypesLookup?.length > 1 }">
            <legend class="visually-hidden">Project</legend>
            <!-- Project Type -->
            <div *ngIf="projectsTypesLookup?.length > 1"
                class="position-relative {{ cmpCreationConfig.fieldCustomClass?.['PROJECT_TYPE'] }}">
                <span class="d-flex coi-text-dark pb-1">
                    <span *ngIf="cmpCreationConfig.isEditMode && cmpCreationConfig.mandatoryFieldsList?.[createLocalObject?.cmpType?.cmpTypeCode]?.includes('PROJECT_TYPE')"
                        class="mandatory me-1">*</span>
                    <span>Project Type</span>
                    <app-common-help-text [subSectionId]="2902" [elementId]="'coi-new-cmp-proj-type'"></app-common-help-text>
                </span>
                <!-- options -->
                <div class="d-flex gap-4">
                    <app-dynamic-select class="col d-flex align-items-center gap-3"
                        [lookupList]="projectsTypesLookup"
                        [uniqueId]="'coi-new-cmp-proj-type'" [label]="'Project Type'"
                        [selectedValue]="selectedProjType"
                        [isDisabled]="cmpCreationConfig.disabledFields?.['PROJECT_TYPE']"
                        [isError]="cmpCreationConfig.errorMsgMap.has('PROJECT_TYPE')"
                        (selectedValueChange)="projectTypeChanged($event)">
                    </app-dynamic-select>
                </div>
                <app-common-information [elementId]="'coi-new-cmp-proj-type'" [subSectionId]="2902"></app-common-information>
                <!-- error -->
                <span *ngIf="cmpCreationConfig.errorMsgMap.has('PROJECT_TYPE')"
                    class="d-block invalid-feedback fs-13">{{ cmpCreationConfig.errorMsgMap.get('PROJECT_TYPE') }}</span>
            </div>
            <!-- Project Search -->
            <div class="position-relative {{ cmpCreationConfig.fieldCustomClass?.['PROJECT_SEARCH'] }}">
                <label class="d-flex coi-text-dark pb-1" for="coi-new-cmp-proj-search">
                    <span *ngIf="cmpCreationConfig.isEditMode && cmpCreationConfig.mandatoryFieldsList?.[createLocalObject?.cmpType?.cmpTypeCode]?.includes('PROJECT_SEARCH')"
                        class="mandatory me-1">*</span>
                    <span>Select {{ projectsTypesLookup?.length > 1 ? 'Project' : selectedProjType?.description }}</span>
                    <app-common-help-text [subSectionId]="2902" [elementId]="'coi-new-cmp-proj-search'"></app-common-help-text>
                </label>
                <app-endpoint-search [httpOptions]="projectSearchOptions"
                    [isDisabled]="!selectedProjType?.code || cmpCreationConfig.disabledFields?.['PROJECT_SEARCH']"
                    (onSelect)="selectedProject($event)" [uniqueId]="'coi-new-cmp-proj-search'"
                    [isError]="cmpCreationConfig.errorMsgMap.has('PROJECT_SEARCH')"
                    [placeHolder]="!selectedProjType?.description ? 'Select Project' :
                        ('Search: '+ selectedProjType?.description +' ID, Title, Principal Investigator, Sponsor, '+ selectedProjType?.description +' Lead Unit')">
                </app-endpoint-search>
                <app-common-information [elementId]="'coi-new-cmp-proj-search'" [subSectionId]="2902"></app-common-information>
                <!-- error -->
                <span *ngIf="cmpCreationConfig.errorMsgMap.has('PROJECT_SEARCH')"
                    class="d-block invalid-feedback fs-13">{{ cmpCreationConfig.errorMsgMap.get('PROJECT_SEARCH') }}</span>
            </div>
        </fieldset>
        <!-- error -->
        <span *ngIf="cmpCreationConfig.errorMsgMap.has('PROJECT')"
            class="d-block invalid-feedback fs-13">{{ cmpCreationConfig.errorMsgMap.get('PROJECT') }}</span>
    </div>

    <!-- Academic Department -->
    <div *ngIf="createLocalObject?.cmpType?.cmpTypeCode === CMP_TYPE.UNIVERSITY"
        class="position-relative {{ cmpCreationConfig.fieldCustomClass?.['ACADEMIC_DEPARTMENT'] }}">
        <span class="d-flex coi-text-dark pb-1">
            <span *ngIf="cmpCreationConfig.isEditMode && cmpCreationConfig.mandatoryFieldsList?.[createLocalObject?.cmpType?.cmpTypeCode]?.includes('ACADEMIC_DEPARTMENT')"
                class="mandatory me-1">*</span>
            <span>Academic Department</span>
            <app-common-help-text [subSectionId]="2902" [elementId]="'coi-new-cmp-academic-dept'"></app-common-help-text>
        </span>
        <!-- options -->
        <app-endpoint-search [httpOptions]="academicDeptSearchOptions"
            [isDisabled]="cmpCreationConfig.disabledFields?.['ACADEMIC_DEPARTMENT']"
            (onSelect)="selectedAcademicDept($event)" [uniqueId]="'coi-new-cmp-dept'"
            [isError]="cmpCreationConfig.errorMsgMap.has('ACADEMIC_DEPARTMENT')"
            [placeHolder]="'Search by Academic Department'">
        </app-endpoint-search>
        <app-common-information [elementId]="'coi-new-cmp-dept'" [subSectionId]="2902"></app-common-information>
        <!-- error -->
        <span *ngIf="cmpCreationConfig.errorMsgMap.has('ACADEMIC_DEPARTMENT')"
            class="d-block invalid-feedback fs-13">{{ cmpCreationConfig.errorMsgMap.get('ACADEMIC_DEPARTMENT') }}</span>
    </div>

    <!-- Lab / Center -->
    <div *ngIf="createLocalObject?.cmpType?.cmpTypeCode === CMP_TYPE.UNIVERSITY"
        class="position-relative {{ cmpCreationConfig.fieldCustomClass?.['LAB_CENTER'] }}">
        <span class="d-flex coi-text-dark pb-1">
            <span *ngIf="cmpCreationConfig.isEditMode && cmpCreationConfig.mandatoryFieldsList?.[createLocalObject?.cmpType?.cmpTypeCode]?.includes('LAB_CENTER')"
                class="mandatory me-1">*</span>
            <span>Lab / Center</span>
            <app-common-help-text [subSectionId]="2902" [elementId]="'coi-new-cmp-lab'"></app-common-help-text>
        </span>
        <!-- options -->
        <app-endpoint-search [httpOptions]="labCenterSearchOptions"
            [isDisabled]="cmpCreationConfig.disabledFields?.['LAB_CENTER']"
            (onSelect)="selectedLabCenter($event)" [uniqueId]="'coi-new-cmp-lab'"
            [isError]="cmpCreationConfig.errorMsgMap.has('LAB_CENTER')"
            [placeHolder]="'Search by Lab / Center'">
        </app-endpoint-search>
        <app-common-information [elementId]="'coi-new-cmp-lab'" [subSectionId]="2902"></app-common-information>
        <!-- error -->
        <span *ngIf="cmpCreationConfig.errorMsgMap.has('LAB_CENTER')"
            class="d-block invalid-feedback fs-13">{{ cmpCreationConfig.errorMsgMap.get('LAB_CENTER') }}</span>
    </div>

    <!-- CMP Template -->
    <div *ngIf="createLocalObject?.cmpType?.cmpTypeCode === CMP_TYPE.UNIVERSITY"
        class="position-relative {{ cmpCreationConfig.fieldCustomClass?.['TEMPLATE'] }}">
        <span class="d-flex coi-text-dark pb-1">
            <span *ngIf="cmpCreationConfig.isEditMode && cmpCreationConfig.mandatoryFieldsList?.[createLocalObject?.cmpType?.cmpTypeCode]?.includes('TEMPLATE')"
                class="mandatory me-1">*</span>
            <span>CMP Template</span>
            <app-common-help-text [subSectionId]="2902" [elementId]="'coi-new-cmp-template'"></app-common-help-text>
        </span>
        <!-- options -->
        <div class="d-flex gap-4">
            <app-dynamic-select class="col d-flex align-items-center gap-3"
                [lookupList]="cmpTemplateLookup"
                [uniqueId]="'coi-new-cmp-template'" [label]="'CMP Template'"
                [selectedValue]="{
                    code: createLocalObject?.template?.templateTypeCode,
                    description: createLocalObject?.template?.description }"
                [isError]="cmpCreationConfig.errorMsgMap.has('TEMPLATE')"
                [isDisabled]="cmpCreationConfig.disabledFields?.['TEMPLATE']"
                (selectedValueChange)="templateChanged($event)">
            </app-dynamic-select>
        </div>
        <app-common-information [elementId]="'coi-new-cmp-template'" [subSectionId]="2902"></app-common-information>
        <!-- error -->
        <span *ngIf="cmpCreationConfig.errorMsgMap.has('TEMPLATE')"
            class="d-block invalid-feedback fs-13">{{ cmpCreationConfig.errorMsgMap.get('TEMPLATE') }}</span>
    </div>

</fieldset>
