<div tabindex="-1" class="card coi-card-regular mt-0 border-0" id="COI_DEFINE_RELATIONSHIP_NAV_CARD" [class.rounded-0]="!defineRelationshipService.isEditMode">
    <div class="card-header px-0 pb-0 border-bottom-0 position-sticky z-index-4 rounded-0" [class.p-0]="!defineRelationshipService.isEditMode"
        id="COI_DEFINE_RELATIONSHIP_NAV_HEADER" [style.top]="defineRelationshipService.isEditMode ? '-1px' : '-1px'">
        <div class="row w-100 mx-0" [class.mt-1]="defineRelationshipService.isEditMode">
            <div *ngIf="!defineRelationshipService.isEditMode" class="d-flex align-items-center justify-content-end position-relative px-0"
                [class.coi-active-scrollspy]="coiService.isExpandSummaryBySection['COI803']
                    && defineRelationshipService.scrollSpyConfiguration.activeCounter > 1
                    && defineRelationshipService.scrollSpyConfiguration.activeCounter < filteredProjectSfiRelationsList?.length + 2">
                <a class="coi-nav-link d-flex align-items-center" role="link" tabindex="-1" [class.border-bottom]="!coiService.isExpandSummaryBySection['COI803']"
                    title="Go to Relationships section" aria-label="Go to Relationships section" (focus)="scrollIntoView()" (click)="openIfClose()">
                    <span class="me-2">Relationships</span>
                    <ng-container *ngIf="projectSfiRelationsList?.length && !isEnableProjEngSwitch">
                        <span class="fs-10 count-badge badge rounded-pill align-items-center justify-content-center d-inline-flex rounded-circle">{{ projectSfiRelationsList?.length }}</span>
                    </ng-container>
                </a>
                <div class="position-absolute d-flex align-items-center gap-2 me-2">
                    <!-- open/close Search btn -->
                    <ng-container *ngIf="!isEnableProjEngSwitch && coiService.isExpandSummaryBySection['COI803'] && projectSfiRelationsList?.length">
                        <ng-container *ngTemplateOutlet="searchToggleBtn;"></ng-container>
                    </ng-container>
                    <!-- expand/collapse -->
                    <button id="relationship_collapse_btn" (click)="expandCollapseRelationship()"
                        [attr.aria-label]="coiService.isExpandSummaryBySection['COI803'] ? 'Click here to collapse relationship' : 'Click here to expand relationship'"
                        class="position-static d-flex justify-content-center align-items-center btn toggle-btn border rounded-5 shadow-sm p-0 coi-scale-9"
                        [title]="coiService.isExpandSummaryBySection['COI803'] ? 'Click here to collapse relationship' : 'Click here to expand relationship'">
                        <mat-icon aria-hidden="true" [ngClass]="coiService.isExpandSummaryBySection['COI803'] ? 'coi-rotate-180' : 'coi-rotate-0'">expand_more</mat-icon>
                    </button>
                </div>
            </div>
            <div *ngIf="isEnableProjEngSwitch && (coiService.isExpandSummaryBySection['COI803'] || defineRelationshipService.isEditMode)"
                class="d-flex gap-2 align-items-center col-12 mb-2" [class.mt-2]="!defineRelationshipService.isEditMode">
                <div class="d-flex align-items-center coi-rel-switch-container overflow-hidden col"
                    [ngClass]="defineRelationshipService.currentRelationSwitch === 'PROJECTS' ? 'coi-rel-switch-right-active' : 'coi-rel-switch-left-active'">
                    <button (click)="switchTab('ENGAGEMENTS')"
                        title="Click here to switch relationship to engagements" aria-label="Click here to switch relationship to engagements"
                        class="btn-none d-flex align-items-center justify-content-center gap-1 w-50 fs-14 coi-rel-switch-btn"
                        [class.coi-rel-switch-active-btn]="defineRelationshipService.currentRelationSwitch === 'ENGAGEMENTS'">
                        <span class="fw-medium">Engagements</span>
                        <span *ngIf="countObj?.engagementCount"
                            class="d-inline-flex align-items-center justify-content-center fs-10 text-bg-danger badge rounded-pill">{{ countObj?.engagementCount }}</span>
                    </button>
                    <button (click)="switchTab('PROJECTS')"
                        title="Click here to switch relationship to engagements" aria-label="Click here to switch relationship to engagements"
                        class="btn-none d-flex align-items-center justify-content-center gap-1 w-50 fs-14 coi-rel-switch-btn"
                        [class.coi-rel-switch-active-btn]="defineRelationshipService.currentRelationSwitch === 'PROJECTS'">
                        <span class="fw-medium">Projects</span>
                        <span *ngIf="countObj?.projectCount"
                            class="d-inline-flex align-items-center justify-content-center fs-10 text-bg-danger badge rounded-pill">{{ countObj?.projectCount }}</span>
                    </button>
                </div>
                <!-- open/close Search btn -->
                <ng-container *ngIf="projectSfiRelationsList?.length">
                    <ng-container *ngTemplateOutlet="searchToggleBtn;"></ng-container>
                </ng-container>
            </div>
            <div *ngIf="!isEnableProjEngSwitch && defineRelationshipService.isEditMode" class="col-12 px-3 d-flex align-items-center gap-1 mb-2 lh-1">
                <span class="coi-text-darker fs-16">Projects</span>
                <ng-container *ngIf="projectSfiRelationsList?.length">
                    <span class="d-inline-flex align-items-center justify-content-center fs-10 count-badge badge rounded-pill">{{ projectSfiRelationsList?.length }}</span>
                    <!-- open/close Search btn -->
                    <ng-container *ngTemplateOutlet="searchToggleBtn;"></ng-container>
                </ng-container>
            </div>
            <ng-template #searchToggleBtn>
                <!-- open/close Search btn -->
                <button class="d-flex align-items-center btn p-1 rounded-circle ms-auto fs-13 coi-scale-9"
                    id="coi-proj-rel-search-toggle_btn" (click)="isShowFilter = !isShowFilter"
                    title="Click here to {{ isShowFilter ? 'close' : 'show' }} search"
                    [ngClass]="isShowFilter ? 'btn-primary' : 'btn-tertiary mt-0 coi-min-w-0'"
                    attr.aria-label="Click here to {{ isShowFilter ? 'close' : 'show' }} search">
                    <mat-icon aria-hidden="true" class="flex-shrink-0">search</mat-icon>
                </button>
            </ng-template>
            <div *ngIf="coiService.isExpandSummaryBySection['COI803']" class="p-0 border-bottom"></div>
            <div *ngIf="coiService.isExpandSummaryBySection['COI803'] && projectSfiRelationsList?.length && isShowFilter"
                class="col-12 p-0" [@heightAnimation]>
                <div class="d-flex align-items-center gap-2 border-bottom p-3">
                    <div class="d-flex align-items-center position-relative w-100">
                        <mat-icon aria-hidden="true" class="position-absolute start-6px light-color">search</mat-icon>
                        <input type="text" autocomplete="off"
                            class="form-control p-x-2rem rounded-2" id="coi-proj-rel-search-inp"
                            name="coi-proj-rel-search-inp"
                            [placeholder]="searchPlaceholder[defineRelationshipService.currentRelationSwitch]"
                            [(ngModel)]="defineRelationshipService.searchText" (ngModelChange)="searchProjectDetails()">
                        <button *ngIf="defineRelationshipService.searchText" (click)="resetList()"
                            class="btn-none d-flex align-items-center position-absolute end-8px coi-text-lighter"
                            aria-label="Click here to clear search text" title="Click here to clear search text"
                            id="coi-proj-rel-search-close-btn">
                            <mat-icon class="light-color" aria-hidden="true">close</mat-icon>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div *ngIf="coiService.isExpandSummaryBySection['COI803'] || defineRelationshipService.isEditMode" class="card-body rounded-0 border-none position-relative" id="COI_DEFINE_RELATIONSHIP_NAV_BODY"
        [class.min-height-200px]="defineRelationshipService.isLoading" tabindex="-1"
        [ngClass]="{'d-flex align-items-center justify-content-center': !filteredProjectSfiRelationsList?.length}">
        <ng-container *ngIf="!defineRelationshipService.isLoading; else showLoader">
            <ul *ngIf="filteredProjectSfiRelationsList?.length; else showNoData" class="list-unstyled m-0 ps-3 pe-0 py-0">
                <li *ngFor="let projectSfiRelation of filteredProjectSfiRelationsList; let navIndex = index">
                    <!-- tabindex is set to -1 for navigation with up/down keys only -->
                    <a *ngIf="defineRelationshipService.currentRelationSwitch === 'PROJECTS'"
                        (focus)="coiService.setActiveSection('COI803')"
                        class="row m-0 w-100 gap-4 pb-3 pt-2 border-bottom text-decoration-none cursor-pointer coi-scrollspy-right"
                        [class.scrollspy-activate]="defineRelationshipService.scrollSpyConfiguration.activeCounter== (defineRelationshipService.isEditMode ? navIndex : navIndex + 2)"
                        [title]="'Click here to view relationship details of #' + projectSfiRelation?.projectNumber + ' -' + projectSfiRelation?.title"
                        [attr.aria-label]="'Click here to view relationship details of #' + projectSfiRelation?.projectNumber + ' -' + projectSfiRelation?.title"
                        [id]="'COI_PROJECT_SFI_RELATION_NAV_' + navIndex" tabindex="-1">
                        <div class="col-12 px-3 pt-2">
                            <!-- badge -->
                            <div class="d-flex align-items-center justify-content-between coi-card-body-notch-container">
                                <div class="d-flex align-items-center">
                                    <div [style.background-color]="projectSfiRelation?.projectBadgeColour"
                                        class="coi-card-notch-ribbon rounded-start-0 mb-auto p-2">{{ projectSfiRelation?.projectType }}</div>
                                    <div class="d-flex align-items-end ms-2">
                                        <mat-icon aria-hidden="true" class="coi-text-light flex-shrink-0 coi-mat-icon-size">{{projectSfiRelation?.projectIcon}}</mat-icon>
                                        <span class="coi-text-dark lh-1"
                                            [title]="'Click here to view relationship details of #' + projectSfiRelation?.projectNumber + ' -' + projectSfiRelation?.title"
                                            [attr.aria-label]="'Click here to view relationship details of #' + projectSfiRelation?.projectNumber + ' -' + projectSfiRelation?.title">
                                            <span class="text-slice">#{{projectSfiRelation?.projectNumber}} - {{projectSfiRelation?.title}}</span>
                                        </span>
                                    </div>
                                </div>
                                <!-- defined or not icon -->
                                <span *ngIf="projectSfiRelation?.conflictCompleted || !projectSfiRelation?.coiDisclEntProjDetails?.length"
                                    class="coi-circle-icons bg-success ms-1"><mat-icon aria-hidden="true" class="text-white flex-shrink-0 coi-scale-7">check</mat-icon></span>
                                <span *ngIf="!projectSfiRelation?.conflictCompleted && projectSfiRelation?.coiDisclEntProjDetails?.length"
                                    class="coi-circle-icons ms-1"><mat-icon aria-hidden="true" class="text-danger flex-shrink-0 fs-24 coi-scale-9">not_interested</mat-icon></span>
                            </div>
                        </div>
                        <!-- conflict counts -->
                        <div class="col-12 d-flex align-items-center justify-content-between">
                            <ng-container *ngFor="let status of defineRelationshipService.relationshipConflictType; let last = last">
                                <div class="d-flex align-items-center fs-12 coi-text-light fw-600">
                                    <span class="text-nowrap">{{ status?.projectConflictStatus }}</span>
                                    <span class="me-2">:</span>
                                    <span [ngClass]="status?.color" class="conflict-count-width">{{ projectSfiRelation?.conflictCount?.[status?.statusCode] ?? 0 }}</span>
                                </div>
                                <span *ngIf="!last" class="me-2 coi-text-lighter">|</span>
                            </ng-container>
                        </div>
                    </a>
                    <!-- tabindex is set to -1 for navigation with up/down keys only -->
                    <a *ngIf="defineRelationshipService.currentRelationSwitch === 'ENGAGEMENTS'"
                        (focus)="coiService.setActiveSection('COI803')"
                        class="row m-0 w-100 gap-2 pb-3 pt-2 border-bottom text-decoration-none cursor-pointer coi-scrollspy-right"
                        [class.scrollspy-activate]="defineRelationshipService.scrollSpyConfiguration.activeCounter== (defineRelationshipService.isEditMode ? navIndex : navIndex + 2)"
                        [title]="'Click here to view relationship details of ' + projectSfiRelation?.personEntity?.entityName"
                        [attr.aria-label]="'Click here to view relationship details of ' + projectSfiRelation?.personEntity?.entityName"
                        [id]="'COI_PROJECT_SFI_RELATION_NAV_' + navIndex" tabindex="-1">
                        <div class="col-12 pe-3 pt-2">
                            <!-- badge -->
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                    <span class="coi-icon-bg me-2 fs-14 d-inline-flex"><mat-icon aria-hidden="true" class="coi-mat-icon-size coi-coloured-icons">domain</mat-icon></span>
                                    <span class="coi-text-dark lh-1"
                                        [title]="'Click here to view relationship details of ' + projectSfiRelation?.personEntity?.entityName"
                                        [attr.aria-label]="'Click here to view relationship details of ' + projectSfiRelation?.personEntity?.entityName">
                                        <span class="text-slice">{{ projectSfiRelation?.personEntity?.entityName }}</span>
                                    </span>
                                </div>
                                <!-- defined or not icon -->
                                <span *ngIf="projectSfiRelation?.conflictCompleted || !projectSfiRelation?.coiDisclEntProjDetails?.length"
                                    class="coi-circle-icons bg-success ms-1"><mat-icon aria-hidden="true" class="text-white flex-shrink-0 coi-scale-7">check</mat-icon></span>
                                <span *ngIf="!projectSfiRelation?.conflictCompleted && projectSfiRelation?.coiDisclEntProjDetails?.length"
                                    class="coi-circle-icons ms-1"><mat-icon aria-hidden="true" class="text-danger flex-shrink-0 fs-24 coi-scale-9">not_interested</mat-icon></span>
                            </div>
                        </div>
                        <!-- conflict counts -->
                        <div class="col-12 d-flex align-items-center justify-content-between">
                            <ng-container *ngFor="let status of defineRelationshipService.relationshipConflictType; let last = last">
                                <div class="d-flex align-items-center fs-12 coi-text-light fw-600">
                                    <span class="text-nowrap">{{ status?.projectConflictStatus }}</span>
                                    <span class="me-2">:</span>
                                    <span [ngClass]="status?.color" class="conflict-count-width">{{ projectSfiRelation?.conflictCount?.[status?.statusCode] ?? 0 }}</span>
                                </div>
                                <span *ngIf="!last" class="me-2 coi-text-lighter">|</span>
                            </ng-container>
                        </div>
                    </a>
                </li>
            </ul>
            <ng-template #showNoData>
                <div class="d-flex align-items-center justify-content-center ps-3">
                    <app-no-information customClass="mt-0" [isBorderNeeded]="false">
                        <span *ngIf="!projectSfiRelationsList?.length">{{ RELATIONSHIP_TAB_NO_PROJECT_INFO_MSG[defineRelationshipService.currentRelationSwitch] }}</span>
                        <span *ngIf="projectSfiRelationsList?.length && defineRelationshipService.searchText">
                            <span *ngIf="defineRelationshipService.currentRelationSwitch === 'PROJECTS'">{{ RELATIONSHIP_TAB_NO_PROJECT_INFO_MSG.NO_PROJECT_SEARCH_RESULT }}</span>
                            <span *ngIf="defineRelationshipService.currentRelationSwitch === 'ENGAGEMENTS'">{{ RELATIONSHIP_TAB_NO_PROJECT_INFO_MSG.NO_ENGAGEMENT_SEARCH_RESULT }}</span>
                        </span>
                    </app-no-information>
                </div>
            </ng-template>
        </ng-container>
        <ng-template #showLoader>
            <div class="w-100 h-100 d-flex align-items-center position-absolute justify-content-center">
                <mat-icon class="text-primary coi-refresh-rotate-animation">cached</mat-icon>
            </div>
        </ng-template>
    </div>
</div>
