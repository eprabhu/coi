<div class="d-flex flex-column gap-2">
    <div class="d-flex flex-column gap-2">
        <div *ngIf="isFormEditable" class="d-flex justify-content-between alert alert-primary align-items-center gap-2 mb-0 p-2" role="alert">
            <p class="fs-14 mb-0 ms-2">
                <span class="d-flex align-items-start">
                    <mat-icon class="mat-icon material-icons flex-shrink-0 me-2" aria-hidden="true">info</mat-icon>
                     <!-- <span *ngIf="!isFormEditable">The OPA engagements associated with this disclosure are listed below.</span> -->
                     <span class="d-inline-flex flex-column gap-2">
                         <span class="d-inline-flex gap-1"><span>Your current list of OPA Engagements, Complete, Incomplete, and Inactive, is displayed below. Please use buttons on the right of each listing to <strong>View</strong> or add <strong>Comments</strong>. An <strong>Incomplete</strong> Engagement (indicated on right side of listing) must be either Completed or Inactivated prior to submitting disclosure.  Click the vertical 3-ellipsis button to <strong>Modify</strong> or <strong>Inactivate</strong>.
                             <span *ngIf="!expandInfo" (click)="expandInfo = true" (keyup.enter)="expandInfo = true"
                             class="fw-700 link-primary ms-1 text-decoration-underline"
                             aria-label="Click here to read more" title="Click here to read more" 
                             tabindex="0" role="link">Read More</span></span>
                         </span>
                         <ng-container *ngIf="expandInfo">
                             <span class="d-inline-flex gap-1"><span>If you were on <strong>sabbatical/leave</strong> and were in residence and/or had an appointment or affiliation at one of your Engagement entities, please select the <strong>Fall</strong> or <strong>Spring</strong> at the bottom of the listing . If it is at a new engagement, click the <strong>+ Add Engagement</strong> button to create a new Engagement.
                                 <span (click)="expandInfo = false" (keyup.enter)="expandInfo = false"
                                 class="fw-700 link-primary ms-1 text-decoration-underline"
                                 aria-label="Click here to read less" title="Click here to read less"
                                 tabindex="0" role="link">Read Less</span></span>
                             </span>
                         </ng-container>
                     </span>
                </span>
            </p>
            <button *ngIf="isFormEditable" id="opa-add-engagement-btn" [class.mb-auto]="expandInfo"
                class="d-inline-flex btn btn-primary fs-14" (click)="createNewEngagement()"
                title="Click here to add new engagement" aria-label="Click here to add new engagement">
                <mat-icon aria-hidden="true" class="flex-shrink-0 me-1">add</mat-icon>
                <span class="text-nowrap">Add Engagement</span>
            </button>
        </div>
    </div>
    <div *ngIf="!isHideFilterSearchAndShowCreate && isFormEditable" id="opa-eng-pe-sticky-header" class="d-flex flex-column gap-2">
        <div id="opa-eng-pe-ftr-container" class="advance-search coi-search-box">
            <div class="row m-0">
                <div role="radiogroup" aria-label="Engagement Filter Types"  class="col-lg-auto px-3 py-2">
                    <span class="coi-text-light fw-500">Filter By Status :</span>
                    <!-- All -->
                    <button (click)="setFilter('ALL')" id="opa-eng-pe-ftr-all"
                        [class.active-filter-pills]="opaPersonEngagementRO.filterType === 'ALL'"
                        [attr.aria-label]="opaPersonEngagementRO.filterType === 'ALL'
                            ? 'Selected filter type is All ' : 'Click here to filter engagements by type: All'"
                        [title]="opaPersonEngagementRO.filterType === 'ALL'
                            ? 'All' : 'Click here to filter engagements by type: All'"
                        class="filter-pills coi-text-light" role="radio"
                        [attr.aria-checked]="opaPersonEngagementRO.filterType === 'ALL'">
                        All
                    </button>
                    <!-- Complete -->
                    <button (click)="setFilter('COMPLETE')" id="opa-eng-pe-ftr-complete-1"
                        [class.active-filter-pills]="opaPersonEngagementRO.filterType === 'COMPLETE'"
                        [attr.aria-label]="opaPersonEngagementRO.filterType === 'COMPLETE'
                            ? 'Selected filter type is Complete ' : 'Click here to filter engagements by type: Complete'"
                        [title]="opaPersonEngagementRO.filterType === 'COMPLETE'
                            ? 'Complete' : 'Click here to filter engagements by type: Complete'"
                        class="filter-pills coi-text-light" role="radio"
                        [attr.aria-checked]="opaPersonEngagementRO.filterType === 'COMPLETE'">
                        Complete
                    </button>
                    <!-- Incomplete -->
                    <button (click)="setFilter('INCOMPLETE')" id="opa-eng-pe-ftr-incomplete"
                        [class.active-filter-pills]="opaPersonEngagementRO.filterType === 'INCOMPLETE'"
                        [attr.aria-label]="opaPersonEngagementRO.filterType === 'INCOMPLETE'
                            ? 'Selected filter type is Incomplete ' : 'Click here to filter engagements by type: Incomplete'"
                        [title]="opaPersonEngagementRO.filterType === 'INCOMPLETE'
                            ? 'Incomplete' : 'Click here to filter engagements by type: Incomplete'"
                        class="filter-pills coi-text-light" role="radio"
                        [attr.aria-checked]="opaPersonEngagementRO.filterType === 'INCOMPLETE'">
                        Incomplete
                    </button>
                    <!-- Active -->
                    <button (click)="setFilter('ACTIVE')" id="opa-eng-pe-ftr-active"
                        [class.active-filter-pills]="opaPersonEngagementRO.filterType === 'ACTIVE'"
                        [attr.aria-label]="opaPersonEngagementRO.filterType === 'ACTIVE'
                            ? 'Selected filter type is Active ' : 'Click here to filter engagements by type: Active'"
                        [title]="opaPersonEngagementRO.filterType === 'INACTIVE'
                            ? 'Active' : 'Click here to filter engagements by type: Active'"
                        class="filter-pills coi-text-light" role="radio"
                        [attr.aria-checked]="opaPersonEngagementRO.filterType === 'ACTIVE'">
                        Active
                    </button>
                    <!-- Inactive -->
                    <button (click)="setFilter('INACTIVE')" id="opa-eng-pe-ftr-inactive"
                        [class.active-filter-pills]="opaPersonEngagementRO.filterType === 'INACTIVE'"
                        [attr.aria-label]="opaPersonEngagementRO.filterType === 'INACTIVE'
                            ? 'Selected filter type is Inactive ' : 'Click here to filter engagements by type: Inactive'"
                        [title]="opaPersonEngagementRO.filterType === 'INACTIVE'
                            ? 'Inactive' : 'Click here to filter engagements by type: Inactive'"
                        class="filter-pills coi-text-light" role="radio"
                        [attr.aria-checked]="opaPersonEngagementRO.filterType === 'INACTIVE'">
                        Inactive
                    </button>
                </div>
              <div class="d-flex align-items-center col-lg py-2 border-start filter-s-outer search-area position-relative">
              <span class="filter-search">
                  <mat-icon aria-hidden="true" class="fs-25px searchButton">search</mat-icon>
                  <input class="form-control pe-5" type="text" id="searchText" placeholder="Search Engagements" [(ngModel)]="searchText" (ngModelChange)="getEngagements()">
                </span>
                <span type="button" tabindex="0" aria-label="Clear Search Text" class="d-flex align-items-center" *ngIf="searchText" (click)="clearSearchText()" (keyup.enter)="clearSearchText()">
                  <mat-icon class="closeButton" aria-hidden="true">close</mat-icon>
               </span>
              </div>
          </div>
        </div>
    </div>
    <div *ngFor="let engagementDetails of componentData?.engagementDetails; let isLast = last;" class="pt-1">
        <app-shared-form-engagement-card [engagementDetails]="engagementDetails"
            [sabbaticalType]="sabbaticalType" [isFormEditable]="isFormEditable"
            [formBuilderId]="formBuilderId" (cardActions)="emitActionEvents($event)"
            [externalEvents]="externalEvents"></app-shared-form-engagement-card>
    </div>
    <ng-container *ngIf="isLoading">
        <!-- This empty div is used to maintain spacing during filter transitions. -->
        <div class="custom-loading-time-background w-100">
        </div>
    </ng-container>
    <ng-container *ngIf="!componentData?.engagementDetails?.length && !isLoading">
        <!-- no data card -->
        <app-form-no-information *ngIf="isHideFilterSearchAndShowCreate" [isBorderNeeded]="isFormEditable"
            [canShowAddButton]="isFormEditable" [buttonName]="'Add Engagement'" (buttonAction)="createNewEngagement()"
            [customClass]="isFormEditable? 'mt-0': 'mt-0 p-0'">
            <span *ngIf="isFormEditable">You haven't created any engagement yet. Click 'Add Engagement' to create one.</span>
            <span *ngIf="!isFormEditable">There are no OPA engagements associated with this disclosure.</span>
        </app-form-no-information>

        <!-- no data card for search and filter -->
        <app-form-no-information *ngIf="!isHideFilterSearchAndShowCreate" [isBorderNeeded]="isFormEditable"
            [customClass]="'mt-0 p-0'">
            <span *ngIf="isFormEditable">
                {{ searchText ? noDataMessage?.['NO_SEARCH_RESULT'] : noDataMessage?.[opaPersonEngagementRO?.filterType]}}
            </span>
            <span *ngIf="!isFormEditable">There are no OPA engagements associated with this disclosure.</span>
        </app-form-no-information>
    </ng-container>
</div>
