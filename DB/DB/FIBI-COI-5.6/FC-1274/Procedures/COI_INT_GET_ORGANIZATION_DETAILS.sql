DELIMITER //
CREATE PROCEDURE COI_INT_GET_ORGANIZATION_DETAILS(IN AV_ENTITY_ID INT)
BEGIN
   
      SELECT
        ESOI.ENTITY_ID,
        CONVERT(ESOI.ORGANIZATION_ID, CHAR) AS ORGANIZATION_ID,
        SUBSTR(ESOI.ORGANIZATION_NAME, 1, 200) AS ORGANIZATION_NAME,
        CASE WHEN ESOI.PRIMARY_ADDRESS_LINE_1 IS NOT NULL THEN SUBSTR(ESOI.PRIMARY_ADDRESS_LINE_1, 1, 80) ELSE NULL END  AS ORG_ADDRESS_LINE_1,
        CASE WHEN ESOI.PRIMARY_ADDRESS_LINE_2 IS NOT NULL THEN SUBSTR(ESOI.PRIMARY_ADDRESS_LINE_2, 1, 80) ELSE NULL END AS ORG_ADDRESS_LINE_2,
        ESOI.CITY  AS ORG_CITY,
        ESOI.STATE AS ORG_STATE,
        ESOI.POST_CODE AS ORG_POST_CODE,
        CASE WHEN ESOI.COUNTRY_CODE IS NOT NULL THEN SUBSTR(ESOI.COUNTRY_CODE, 1, 80) ELSE NULL END AS ORG_COUNTRY_CODE,
        ESOI.EMAIL_ADDRESS,
        ESOI.UPDATED_BY,
        ESOI.NUMBER_OF_EMPLOYEES,
        ESOI.NUMBER_OF_EMPLOYEES,
        SUBSTR(ESOI.FEDERAL_EMPLOYER_ID, 1, 15) AS FEDERAL_EMPLOYER_ID,
        ESOI.UEI_NUMBER,
        ESOI.CAGE_NUMBER,
        ESOI.INCORPORATED_DATE,
        ESOI.INCORPORATED_IN,
        ESOI.DUNS_NUMBER,
        SUBSTR(ESOI.IRS_TAX_EXEMPTION,1,30) AS IRS_TAX_EXEMPTION,
        SUBSTR(ESOI.MASS_TAX_EXEMPT_NUM,1,30) AS MASS_TAX_EXEMPT_NUM,
        SUBSTR(ESOI.AGENCY_SYMBOL,1,30) AS AGENCY_SYMBOL,
        SUBSTR(ESOI.VENDOR_CODE,1,30) AS VENDOR_CODE,
        SUBSTR(ESOI.COM_GOV_ENTITY_CODE,1,30) AS COM_GOV_ENTITY_CODE,
        SUBSTR(ESOI.MASS_EMPLOYEE_CLAIM,1,30)AS MASS_EMPLOYEE_CLAIM,
        SUBSTR(ESOI.HUMAN_SUB_ASSURANCE,1,30) AS HUMAN_SUB_ASSURANCE,
        SUBSTR(ESOI.ANIMAL_WELFARE_ASSURANCE,1,20) AS ANIMAL_WELFARE_ASSURANCE,
        ESOI.SCIENCE_MISCONDUCT_COMPL_DATE,
        SUBSTR(ESOI.PHS_ACOUNT,1,30) AS PHS_ACOUNT,
        SUBSTR(ESOI.NSF_INSTITUTIONAL_CODE,1,30) AS NSF_INSTITUTIONAL_CODE,
        ESOI.INDIRECT_COST_RATE_AGREEMENT,
        SUBSTR(CONVERT(ESOI.COGNIZANT_AUDITOR,UNSIGNED),1,6) AS COGNIZANT_AUDITOR,
        SUBSTR(CONVERT(ESOI.ONR_RESIDENT_REP,UNSIGNED),1,6) AS ONR_RESIDENT_REP,
        ESOI.LOBBYING_REGISTRANT,
        ESOI.LOBBYING_INDIVIDUAL,
        ESOI.SAM_EXPIRATION_DATE,
        ESOI.FEED_STATUS_CODE as ORG_FEED_STATUS_CODE,
        SUBSTR(CONVERT(ESOI.PHONE_NUMBER , CHAR),1,20) AS PHONE_NUMBER,
        ERL.DESCRIPTION AS RISK_LEVEL,
        ESOI.CONGRESSIONAL_DISTRICT,
        ESOI.ORGANIZATION_TYPE_CODE,
        ESOI.SUB_AWD_RISK_ASSMT_DATE
    FROM ENTITY_SUB_ORG_INFO ESOI
    LEFT JOIN ENTITY_RISK ER ON ER.ENTITY_ID = ESOI.ENTITY_ID AND ER.RISK_TYPE_CODE = '4'
    LEFT JOIN ENTITY_RISK_LEVEL ERL ON ERL.RISK_LEVEL_CODE = ER.RISK_LEVEL_CODE
    WHERE ESOI.ENTITY_ID = AV_ENTITY_ID
	AND ESOI.FEED_STATUS_CODE IN ('2', '4');

END
//
