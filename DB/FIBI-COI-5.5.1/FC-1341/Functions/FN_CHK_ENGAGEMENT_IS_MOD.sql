DELIMITER //
CREATE FUNCTION FN_CHK_ENGAGEMENT_IS_MOD(
    AV_DISCLOSURE_ID INT
) RETURNS varchar(6) 
    DETERMINISTIC
BEGIN
	DECLARE LI_SFI_FLAG INT DEFAULT 0;
SELECT COUNT(1) INTO LI_SFI_FLAG
             FROM COI_DISCL_PROJECT_ENTITY_REL T1
  		   INNER JOIN COI_DISCL_PROJECTS T9 ON T9.COI_DISCL_PROJECTS_ID = T1.COI_DISCL_PROJECTS_ID
             INNER JOIN PERSON_ENTITY T2 ON T2.PERSON_ENTITY_NUMBER = T1.PERSON_ENTITY_NUMBER
             LEFT JOIN COI_PROJECT_AWARD_V T5 ON T5.AWARD_NUMBER = T9.MODULE_ITEM_KEY AND T9.MODULE_CODE = 1
             LEFT JOIN COI_PROJECT_PROPOSAL_V T6 ON T6.PROPOSAL_NUMBER = T9.MODULE_ITEM_KEY AND T9.MODULE_CODE = 3
             LEFT JOIN coi_project_institute_proposal_v T8 ON T8.PROPOSAL_NUMBER = T9.MODULE_ITEM_KEY AND T9.MODULE_CODE = 2
             INNER JOIN ENTITY T7 ON T7.ENTITY_ID = T1.ENTITY_ID
             WHERE  (T1.PREVIOUS_PERSON_ENTITY_ID IS NOT NULL AND T1.PERSON_ENTITY_ID != T1.PREVIOUS_PERSON_ENTITY_ID ) AND T9.DISCLOSURE_ID = AV_DISCLOSURE_ID;
			
		IF LI_SFI_FLAG > 0 THEN 
		RETURN 'TRUE';		
		END IF;

	
RETURN 'FALSE';

END;
//
