DELIMITER //
CREATE PROCEDURE `UNLINK_DNB_MATCH_DETAIL`(
	IN AV_ENTITY_ID INT,
	IN AV_PERSON_ID VARCHAR(40)
)
BEGIN
 
        UPDATE ENTITY 
        SET FOREIGN_NAME = NULL,
            PRIOR_NAME = NULL,
            SHORT_NAME = NULL,
            DUNS_NUMBER = NULL,
            UEI_NUMBER = NULL,
            CAGE_NUMBER = NULL,
			FEDERAL_EMPLOYER_ID = NULL,
            ENTITY_OWNERSHIP_TYPE_CODE = NULL,
            OPERATING_STATUS_TYPE_CODE = NULL,
            BUSINESS_TYPE_CODE = NULL,
            WEBSITE_ADDRESS = NULL,
            START_DATE = NULL,
            INCORPORATION_DATE = NULL,
            NUMBER_OF_EMPLOYEES = NULL,
            CERTIFIED_EMAIL = NULL,
            ACTIVITY_TEXT = NULL,
            CURRENCY_CODE = NULL,
            PHONE_NUMBER = NULL,
            PRIMARY_ADDRESS_LINE_2 = NULL,
            STATE = CASE 
              WHEN COUNTRY_CODE IN ('USA', 'CAN') THEN STATE
              ELSE NULL
            END,
			POST_CODE = CASE 
                  WHEN COUNTRY_CODE IN ('USA', 'CAN') THEN POST_CODE
                  ELSE NULL
            END,
            HUMAN_SUB_ASSURANCE = NULL,
            ANIMAL_WELFARE_ASSURANCE = NULL,
            ANIMAL_ACCREDITATION = NULL,
			UPDATED_BY = AV_PERSON_ID,
            UPDATE_TIMESTAMP = NOW(),
            IS_DUNS_MATCHED = 'N'
        WHERE ENTITY_ID = AV_ENTITY_ID;
		
		DELETE FROM ENTITY_INDUSTRY_CLASSIFICATION WHERE ENTITY_ID = AV_ENTITY_ID;
		DELETE FROM ENTITY_REGISTRATION WHERE ENTITY_ID = AV_ENTITY_ID;
		DELETE FROM ENTITY_TELEPHONE WHERE ENTITY_ID = AV_ENTITY_ID;
		DELETE FROM ENTITY_FOREIGN_NAME WHERE ENTITY_ID = AV_ENTITY_ID;
		DELETE FROM ENTITY_MAILING_ADDRESS WHERE ENTITY_ID = AV_ENTITY_ID AND ADDRESS_TYPE_CODE = 2;
		
END
//
