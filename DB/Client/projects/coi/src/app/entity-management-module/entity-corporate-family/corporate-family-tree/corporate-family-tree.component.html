<div class="coi-family-tree">
    <div class="coi-family-tree-container">
        <ng-container
            *ngTemplateOutlet="entityTreeNodeTemplate; context: { entity: entityCorporateFamilyService.coporateFamilyTree, level: 0 }"></ng-container>
    </div>

    <ng-template #entityTreeNodeTemplate let-entity="entity" let-level="level">
        <div class="coi-family-tree-node">
            <div class="d-flex align-items-center"
                [ngClass]="{'coi-node-white': level % 2 === 0, 'coi-node-grey': level % 2 !== 0, 'coi-node-selected': entityCorporateFamilyService?.foundEntitiesId?.includes(entity?.entityId)}">
                <button class="btn coi-node-btn-link coi-coloured-icons" *ngIf="entity?.child?.length" (click)="entity.visible = !entity.visible">
                    <mat-icon class="bg-white shadow-sm collapse-icon" aria-hidden="true">{{ entity?.visible ? 'remove' :
                        'add' }}</mat-icon>
                </button>
                <span class="coi-coloured-icons coi-family-tree-node-link"><mat-icon aria-hidden="true"
                        class="coi-family-tree-entity-icon coi-entity-icon-bg coi-mat-icon-size">domain</mat-icon></span>
                <span class="fs-14 fw-bold link-primary" (click)="openEntity(entity)">{{entity?.entityName}}</span>
            </div>
            <div *ngFor="let child of entity?.child;let i = index" class="coi-family-tree-container"
                [ngClass]="{'d-none': !entity?.visible }">
                <ng-container
                    *ngTemplateOutlet="entityTreeNodeTemplate; context: { entity: child, level: level + i + 1  }"></ng-container>
            </div>
        </div>
    </ng-template>
</div>
