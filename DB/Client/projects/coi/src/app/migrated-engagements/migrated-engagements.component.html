<div *ngIf="showBanner">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2 matching-card px-3 py-2 rounded-1 mb-2">
        <div class="d-flex flex-column">
            <div class="d-flex align-items-center mb-1">
                <mat-icon aria-hidden="true" class="me-1 flex-shrink-0">info</mat-icon>
                <small class="banner-text-color fw-semibold fs-6">Confirm and Transfer your existing active SFI entities</small>
            </div>
            <div class="banner-text-color fs-14">
                Weâ€™ve identified your existing active SFI entities from the old legacy disclosure module and prepared them
                for review in MyCOI/OPA+. Please review the listed entities and confirm their transfer to MyCOI-OPA+.
                This mandatory step is essential for creating your new Initial FCOI disclosure. 
            </div>
        </div>
        <button class="btn-none align-self-end align-self-md-center" (click)="showBanner = false" aria-label="Click here to close banner" title="Click here to close banner">
            <mat-icon class="text-dark">close</mat-icon>
        </button>
    </div>
</div>

<section class="coi-dashboard-tab-sticky coi-custom-top sticky-top-51">
    <div class="advance-search coi-search-box sticky-top">
        <div class="row m-0 align-items-stretch">
            <div class="col-lg-auto col-md-6 col-12 px-3 py-2">
                <div>
                    <span class="text-secondary fs-14" tabindex="-1">Filter By</span>
                    <span class="fw-bold coi-text-dark ms-3" tabindex="-1">Relationship Type:</span>
                    <button type="button" (click)="setFilter('F', filterString)" id="coi-person-engagement-filter-all"
                        [class.active-filter-pills]="headerService.migratedEngagementDashboardRO?.filter === 'F'"
                        [attr.aria-label]="headerService.migratedEngagementDashboardRO?.filter === 'F' ? ENGAGEMENT_LOCALIZE.TERM_FINANCIAL_FOR_REL_PILLS : 'Click here to filter engagements by type: ' + ENGAGEMENT_LOCALIZE.TERM_FINANCIAL_FOR_REL_PILLS"
                        [title]="headerService.migratedEngagementDashboardRO?.filter === 'F' ? ENGAGEMENT_LOCALIZE.TERM_FINANCIAL_FOR_REL_PILLS : 'Click here to filter engagements by type: ' + ENGAGEMENT_LOCALIZE.TERM_FINANCIAL_FOR_REL_PILLS"
                        class="btn-none filter-pills coi-text-light">
                        {{ ENGAGEMENT_LOCALIZE.TERM_FINANCIAL_FOR_REL_PILLS }}
                    </button>
                    <button type="button" (click)="setFilter('T', filterString)" id="coi-person-engagement-filter-complete"
                        [class.active-filter-pills]="headerService.migratedEngagementDashboardRO?.filter === 'T'"
                        [attr.aria-label]="headerService.migratedEngagementDashboardRO?.filter === 'T' ? ENGAGEMENT_LOCALIZE.TERM_TRAVEL_FOR_REL_PILLS : 'Click here to filter engagements by type: ' + ENGAGEMENT_LOCALIZE.TERM_TRAVEL_FOR_REL_PILLS"
                        [title]="headerService.migratedEngagementDashboardRO?.filter === 'T' ? ENGAGEMENT_LOCALIZE.TERM_TRAVEL_FOR_REL_PILLS : 'Click here to filter engagements by type: ' + ENGAGEMENT_LOCALIZE.TERM_TRAVEL_FOR_REL_PILLS"
                        class="btn-none filter-pills coi-text-light">
                        {{ ENGAGEMENT_LOCALIZE.TERM_TRAVEL_FOR_REL_PILLS }}
                    </button>
                </div>
            </div>

            <div class="col-lg-auto px-3 py-2 d-flex align-items-center h-100 border-start responsive-border">
                <div>
                    <span class="fw-bold coi-text-dark" tabindex="-1">Migration Status:</span>
                    <button type="button" (click)="setFilter('', 'TO REVIEW')" id="coi-person-engagement-filter-to-review"
                        [class.active-filter-pills]="headerService.migratedEngagementDashboardRO?.tab === 'TO REVIEW'"
                        [attr.aria-label]="headerService.migratedEngagementDashboardRO?.tab === 'TO REVIEW' ? 'To Do' : 'Click here to filter engagements by type: To Do'"
                        [title]="headerService.migratedEngagementDashboardRO?.tab === 'TO REVIEW' ? 'To Do' : 'Click here to filter engagements by type: To Do'"
                        class="btn-none filter-pills coi-text-light pe-1">
                        To Do
                        <span class="count-badge badge rounded-pill align-items-center justify-content-center d-inline-flex rounded-circle ms-1">
                            <span class="text-slice fs-12 fw-700" [title]="headerService.migratedEngagementsCount?.toReviewCount"> {{ headerService.migratedEngagementsCount?.toReviewCount }} </span>
                        </span>
                    </button>
                    <button type="button" (click)="setFilter('', 'IN PROGRESS')" id="coi-person-engagement-filter-in-progress"
                        [class.active-filter-pills]="headerService.migratedEngagementDashboardRO?.tab === 'IN PROGRESS'"
                        [attr.aria-label]="headerService.migratedEngagementDashboardRO?.tab === 'IN PROGRESS' ? 'In Progress' : 'Click here to filter engagements by type: In Progress'"
                        [title]="headerService.migratedEngagementDashboardRO?.tab === 'IN PROGRESS' ? 'In Progress' : 'Click here to filter engagements by type: In Progress'"
                        class="btn-none filter-pills coi-text-light pe-1">
                        In Progress
                        <span class="count-badge badge rounded-pill align-items-center justify-content-center d-inline-flex rounded-circle ms-1">
                            <span class="text-slice fs-12 fw-700" [title]="headerService.migratedEngagementsCount?.inProgressCount"> {{ headerService.migratedEngagementsCount?.inProgressCount }} </span>
                        </span>
                    </button>
                    <button *ngIf="isShowExcludedEngagements" type="button" (click)="setFilter('', 'EXCLUDED')" id="coi-person-engagement-filter-excluded"
                        [class.active-filter-pills]="headerService.migratedEngagementDashboardRO?.tab === 'EXCLUDED'"
                        [attr.aria-label]="headerService.migratedEngagementDashboardRO?.tab === 'EXCLUDED' ? 'Exclude' : 'Click here to filter engagements by type: Excluded'"
                        [title]="headerService.migratedEngagementDashboardRO?.tab === 'EXCLUDED' ? 'Excluded' : 'Click here to filter engagements by type: Excluded'"
                        class="btn-none filter-pills coi-text-light pe-1">
                        Excluded
                        <span class="count-badge badge rounded-pill align-items-center justify-content-center d-inline-flex rounded-circle ms-1">
                            <span class="text-slice fs-12 fw-700" [title]="headerService.migratedEngagementsCount?.excludedCount"> {{ headerService.migratedEngagementsCount?.excludedCount }} </span>
                        </span>
                    </button>
                    <button type="button" (click)="setFilter('', 'COMPLETED')" id="coi-person-engagement-filter-completed"
                        [class.active-filter-pills]="headerService.migratedEngagementDashboardRO?.tab === 'COMPLETED'"
                        [attr.aria-label]="headerService.migratedEngagementDashboardRO?.tab === 'COMPLETED' ? 'Transferred' : 'Click here to filter engagements by type: Transferred'"
                        [title]="headerService.migratedEngagementDashboardRO?.tab === 'COMPLETED' ? 'Transferred' : 'Click here to filter engagements by type: Transferred'"
                        class="btn-none filter-pills coi-text-light pe-1">
                        Transferred
                        <span class="count-badge badge rounded-pill align-items-center justify-content-center d-inline-flex rounded-circle ms-1">
                            <span class="text-slice fs-12 fw-700" [title]="headerService.migratedEngagementsCount?.completedCount"> {{ headerService.migratedEngagementsCount?.completedCount }} </span>
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="coi-engagements-list mt-2 rounded">
    <div class="coi-engagements-list-header p-3 fw-bold">
        Select and migrate your engagements
    </div>
    <div *ngIf="filteredEntityArray?.length" class="col-12 p-3 pb-0">
        <div class="d-flex flex-wrap align-items-center alert alert-primary mb-0 py-2">
            <mat-icon class="mat-icon material-icons flex-shrink-0" aria-hidden="true">info</mat-icon>
            <p class="d-inline-flex align-items-center fs-14 mb-0 ms-2 col">
                <span class="pe-1">{{ helpText }}</span>
            </p>
        </div>
    </div>

    <div *ngIf="!isLoading" class="mt-1">
        <div *ngIf="filteredEntityArray?.length; else noData">
            <div class="col-12 px-3 pb-3">
                <ng-container *ngFor="let item of filteredEntityArray">
                    <app-migrated-engagements-card [engagementDetails]="item" [isShowFooter]="isShowFooter" [customClass]="'coi-card-regular coi-card-shadow'"
                        (cardActions)="cardActions($event)" [isShowExcludeBtn]="isShowExcludedEngagements">
                    </app-migrated-engagements-card>
                </ng-container>
            </div>
        </div>
    </div>

    <ng-template #noData>
        <div class="px-3 py-3">
            <app-no-information [customClass]="mt-0" [isBorderNeeded]="false"></app-no-information>
        </div>
    </ng-template>
</div>

<div [hidden]="isLoading" *ngIf="filteredEntityArray.length || (headerService.migratedEngagementDashboardRO?.pageNumber !== 1 && !filteredEntityArray.length)"
    class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 mt-3">
    <nav aria-label="pagination section" class="pagination justify-content-end">
        <app-pagination (pageChangeEvent)="actionsOnPageChangeEvent($event)" [totalCount]="result?.count"
            [defaultCurrentPage]="headerService.migratedEngagementDashboardRO?.pageNumber" [pageCount]="headerService.migratedEngagementDashboardRO?.pageLimit">
        </app-pagination>
    </nav>
</div>

<!-- Exclude/Revert Action Modal -->
<app-common-modal *ngIf="isShowEngagementActionModal" [modalConfig]="engagementActionModalConfig"
    (modalAction)="postConfirmation($event)">
    <ng-container modal-header>
        <div class="d-flex gap-2 align-items-center">
            <mat-icon aria-hidden="true" class="flex-shrink-0">info</mat-icon>
            <div>{{ engagementActionModal?.header }}</div>
        </div>
    </ng-container>
    <ng-container modal-body>
        <div class="coi-side-highlight-card fs-14 fw-400 d-flex flex-column rounded p-3">
            <span>{{ engagementActionModal?.message }}</span>
            <span>
                <ul class="list-unstyled">
                    <li>{{ engagementActionModal?.confirmationText }}</li>
                    <li>{{ engagementActionModal?.closingText }}</li>
                </ul>
            </span>
        </div>
    </ng-container>
</app-common-modal>

<!-- Redirect to home Modal -->
<app-common-modal *ngIf="isShowRedirectModal" [modalConfig]="redirectModalConfig" (modalAction)="redirectToHome($event)">
    <ng-container modal-header>
        <div class="d-flex gap-2 align-items-center">
            <mat-icon aria-hidden="true" class="flex-shrink-0">info</mat-icon>
            <div>No More Engagements to Transfer</div>
        </div>
    </ng-container>
    <ng-container modal-body>
        <div class="d-flex align-items-center justify-content-between alert alert-primary mt-1 mb-0 py-2 gap-2">
            <div class="d-flex">
                <p class="fs-14 mb-0 ms-2"><span>You have excluded the last engagement available for migration. You will now be redirected to MyCOI-OPA+.</span></p>
            </div>
        </div>
    </ng-container>
</app-common-modal>
